<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜ë§Œì˜ ë„ì„œê´€</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url('https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=1470&q=80');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: white;
      padding: 20px;
    }

    #library {
      background-color: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 10px;
      max-width: 700px;
      margin: 20px auto;
      color: white;
    }

    h2 {
      margin-top: 0;
      text-align: center;
    }

    .book {
      border-bottom: 1px solid #aaa;
      padding: 10px 0;
    }

    h3, p {
      color: #f0f0f0;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      margin: 5px 0;
    }

    button, select {
      font-size: 16px;
      margin-top: 5px;
    }

    button.favoriteBtn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 24px;
      vertical-align: middle;
      margin-left: 10px;
    }

    button.deleteBtn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 10px;
    }

    button.deleteBtn:hover {
      background-color: #c0392b;
    }

    /* ì±… ì¶”ê°€í•˜ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #addBookBtn {
      display: block;
      margin: 0 auto 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      background: #4a90e2;
      color: white;
      border: none;
      max-width: 200px;
      text-align: center;
    }

    #addBookBtn:hover {
      background: #357ABD;
    }
  </style>
</head>
<body>

  <!-- ì±… ì¶”ê°€í•˜ê¸° ë²„íŠ¼ -->
  <button id="addBookBtn" onclick="location.href='index.html'">â• ì±… ì¶”ê°€í•˜ê¸°</button>

  <div id="library"></div>

  <script>
    const books = JSON.parse(localStorage.getItem("books") || "[]");
    const libraryDiv = document.getElementById("library");

    // ì½ì€ ì±… ê¶Œìˆ˜ í‘œì‹œ
    const countDiv = document.createElement("h2");
    countDiv.textContent = `ì´ ${books.length}ê¶Œì˜ ì±…ì´ ìˆìŠµë‹ˆë‹¤ ğŸ“š`;
    libraryDiv.appendChild(countDiv);

    // ì‚­ì œ ëª¨ë“œ ë²„íŠ¼
    const deleteModeBtn = document.createElement("button");
    deleteModeBtn.textContent = "ğŸ—‘ï¸ ì‚­ì œ ëª¨ë“œ ì¼œê¸°";
    deleteModeBtn.style.display = "block";
    deleteModeBtn.style.margin = "10px auto 20px auto";
    libraryDiv.appendChild(deleteModeBtn);

    let deleteMode = false;

    function renderBooks() {
      // ê¸°ì¡´ ì±… ë¦¬ìŠ¤íŠ¸ ì§€ìš°ê¸°
      document.querySelectorAll(".book").forEach(el => el.remove());

      books.forEach((book, index) => {
        const bookDiv = document.createElement("div");
        bookDiv.className = "book";

        const summaryId = `summary-${index}`;

        bookDiv.innerHTML = `
          <h3>
            ${book.title}
            <button class="favoriteBtn" data-index="${index}">
              ${book.favorite ? "â¤ï¸" : "ğŸ¤"}
            </button>
          </h3>
          <p><strong>ì‘ê°€:</strong> ${book.author}</p>
          <p>
            <button class="toggleSummaryBtn" data-id="${summaryId}">ğŸ“– ì¤„ê±°ë¦¬ ë³´ê¸°</button>
            <div id="${summaryId}" class="summary" style="display:none; margin-top:5px;">
              ${book.summary}
            </div>
          </p>
          <p>
            <strong>í‰ì :</strong>
            <select data-index="${index}">
              <option value="">-- ì„ íƒ --</option>
              <option value="1" ${book.rating == 1 ? "selected" : ""}>â­</option>
              <option value="2" ${book.rating == 2 ? "selected" : ""}>â­â­</option>
              <option value="3" ${book.rating == 3 ? "selected" : ""}>â­â­â­</option>
              <option value="4" ${book.rating == 4 ? "selected" : ""}>â­â­â­â­</option>
              <option value="5" ${book.rating == 5 ? "selected" : ""}>â­â­â­â­â­</option>
            </select>
            ${deleteMode ? `<button class="deleteBtn" data-index="${index}">ì‚­ì œ</button>` : ""}
          </p>
        `;

        libraryDiv.appendChild(bookDiv);
      });

      // í‰ì  ì´ë²¤íŠ¸
      document.querySelectorAll("select").forEach(select => {
        select.addEventListener("change", function() {
          const idx = this.getAttribute("data-index");
          books[idx].rating = parseInt(this.value);
          localStorage.setItem("books", JSON.stringify(books));
        });
      });

      // ì¤„ê±°ë¦¬ ë³´ê¸°/ìˆ¨ê¸°ê¸°
      document.querySelectorAll(".toggleSummaryBtn").forEach(btn => {
        btn.addEventListener("click", function() {
          const targetId = this.getAttribute("data-id");
          const summaryDiv = document.getElementById(targetId);
          if (summaryDiv.style.display === "none") {
            summaryDiv.style.display = "block";
            this.textContent = "ğŸ™ˆ ì¤„ê±°ë¦¬ ìˆ¨ê¸°ê¸°";
          } else {
            summaryDiv.style.display = "none";
            this.textContent = "ğŸ“– ì¤„ê±°ë¦¬ ë³´ê¸°";
          }
        });
      });

      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.addEventListener("click", function() {
          const idx = this.getAttribute("data-index");
          books.splice(idx, 1);
          localStorage.setItem("books", JSON.stringify(books));
          renderBooks();
          countDiv.textContent = `ì´ ${books.length}ê¶Œì˜ ì±…ì´ ìˆìŠµë‹ˆë‹¤ ğŸ“š`;
        });
      });

      // ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll(".favoriteBtn").forEach(btn => {
        btn.addEventListener("click", function() {
          const idx = this.getAttribute("data-index");
          books[idx].favorite = !books[idx].favorite;
          localStorage.setItem("books", JSON.stringify(books));
          renderBooks();
        });
      });
    }

    // ì‚­ì œ ëª¨ë“œ í† ê¸€
    deleteModeBtn.addEventListener("click", () => {
      deleteMode = !deleteMode;
      deleteModeBtn.textContent = deleteMode ? "âŒ ì‚­ì œ ëª¨ë“œ ë„ê¸°" : "ğŸ—‘ï¸ ì‚­ì œ ëª¨ë“œ ì¼œê¸°";
      renderBooks();
    });

    // ì´ˆê¸° ë Œë”ë§
    renderBooks();

    // library.html (ë˜ëŠ” ë‹¤ë¥¸ ë©”ì¸ í˜ì´ì§€ë“¤)ì˜ ë§¨ ìœ„ì— ë„£ì–´
const user = JSON.parse(localStorage.getItem("user"));
if (!user || !user.loggedIn) {
  window.location.href = "login.html";
}

  </script>
</body>
</html>
